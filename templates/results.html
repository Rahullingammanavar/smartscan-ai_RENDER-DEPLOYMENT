<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis Results - Skin Disease Classification</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .risk-high {
        border-left: 5px solid #dc3545 !important;
      }
      .risk-low {
        border-left: 5px solid #28a745 !important;
      }
      .confidence-bar {
        height: 25px;
      }
      .medical-warning {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      }
      .medical-safe {
        background: linear-gradient(135deg, #51cf66, #40c057);
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-microscope me-2"></i>
          Skin Disease AI
        </a>
        <div class="navbar-nav ms-auto">
          <span class="navbar-text">
            <i class="fas fa-brain me-1"></i>
            EfficientNet-B3 | 94.04% Accuracy
          </span>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <!-- Header -->
          <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary">
              <i class="fas fa-chart-line me-3"></i>
              Analysis Results
            </h1>
            <p class="lead text-muted">
              AI-powered skin disease classification with 94.04% accuracy
            </p>
          </div>

          {% if result.error %}
          <!-- Error Display -->
          <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Analysis Error</h4>
            <p>{{ result.error }}</p>
            <hr />
            <p class="mb-0">
              Please try uploading a different image or contact support.
            </p>
          </div>
          {% else %}
          <!-- Results Card -->
          <div class="card shadow-lg border-0">
            <div class="card-body p-5">
              <!-- Risk Warning -->
              {% if result.overall_risk == "High" %}
              <div
                class="alert alert-danger medical-warning text-white border-0 mb-4"
                role="alert"
              >
                <h4 class="alert-heading">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  High Risk Detection
                </h4>
                <p class="mb-0">
                  <strong
                    >Immediate medical consultation strongly
                    recommended.</strong
                  >
                  The AI has detected characteristics that may require urgent
                  attention.
                </p>
              </div>
              {% endif %}

              <!-- Image and Primary Result -->
              <div class="row mb-5">
                <div class="col-md-6">
                  <div class="text-center">
                    <h5 class="text-primary mb-3">
                      <i class="fas fa-image me-2"></i>
                      Analyzed Image
                    </h5>
                    <img
                      src="data:image/png;base64,{{ result.processed_image }}"
                      class="img-fluid rounded shadow"
                      style="max-height: 400px"
                    />
                    <p class="text-muted mt-2 small">
                      Original: {{ result.original_filename }}
                    </p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="primary-result">
                    <h5 class="text-primary mb-3">
                      <i class="fas fa-trophy me-2"></i>
                      Primary Diagnosis
                    </h5>
                    <div
                      class="alert {% if result.top_prediction.warning %}alert-danger{% else %}alert-success{% endif %} border-0 shadow-sm"
                    >
                      <h4 class="alert-heading mb-2">
                        {{ result.top_prediction.class }}
                      </h4>
                      <div class="progress mb-3 confidence-bar">
                        <div
                          class="progress-bar {% if result.top_prediction.warning %}bg-danger{% else %}bg-success{% endif %}"
                          role="progressbar"
                          style="width: {{ result.top_prediction.confidence * 100 }}%"
                          aria-valuenow="{{ result.top_prediction.confidence * 100 }}"
                          aria-valuemin="0"
                          aria-valuemax="100"
                        >
                          {{ "%.1f"|format(result.top_prediction.confidence *
                          100) }}% Confidence
                        </div>
                      </div>
                      <p class="mb-2">
                        <strong>{{ result.top_prediction.description }}</strong>
                      </p>
                      <div class="row">
                        <div class="col-6">
                          <small
                            ><strong>Risk Level:</strong>
                            <span
                              class="badge {% if result.top_prediction.warning %}bg-danger{% else %}bg-success{% endif %}"
                            >
                              {{ result.top_prediction.risk_level }}
                            </span>
                          </small>
                        </div>
                        <div class="col-6">
                          <small
                            ><strong>Model Confidence:</strong>
                            <span class="badge bg-primary">
                              {{ "%.1f"|format(result.model_confidence * 100)
                              }}%
                            </span>
                          </small>
                        </div>
                      </div>
                      {% if result.top_prediction.recommendation %}
                      <hr />
                      <p class="mb-0">
                        <strong>Recommendation:</strong> {{
                        result.top_prediction.recommendation }}
                      </p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>

              <!-- All Predictions -->
              <div class="mb-4">
                <h5 class="text-primary mb-3">
                  <i class="fas fa-list me-2"></i>
                  Complete Analysis
                </h5>
                <div class="row">
                  {% for prediction in result.predictions %}
                  <div class="col-md-6 col-lg-4 mb-3">
                    <div
                      class="card h-100 {% if prediction.warning %}risk-high{% else %}risk-low{% endif %} shadow-sm"
                    >
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-center mb-2"
                        >
                          <h6 class="card-title mb-0">
                            {{ prediction.class }}
                          </h6>
                          {% if prediction.warning %}
                          <span class="badge bg-danger">High Risk</span>
                          {% else %}
                          <span class="badge bg-success">Low Risk</span>
                          {% endif %}
                        </div>
                        <div class="progress mb-3" style="height: 20px">
                          <div
                            class="progress-bar {% if loop.index == 1 %}{% if prediction.warning %}bg-danger{% else %}bg-success{% endif %} {% elif loop.index == 2 %}bg-info {% elif loop.index == 3 %}bg-warning {% else %}bg-secondary{% endif %}"
                            role="progressbar"
                            style="width: {{ prediction.confidence * 100 }}%"
                            aria-valuenow="{{ prediction.confidence * 100 }}"
                            aria-valuemin="0"
                            aria-valuemax="100"
                          >
                            {{ "%.1f"|format(prediction.confidence * 100) }}%
                          </div>
                        </div>
                        <p class="card-text small">
                          {{ prediction.description }}
                        </p>
                        {% if prediction.recommendation %}
                        <div class="mt-2">
                          <small class="text-muted">
                            <strong>Recommendation:</strong> {{
                            prediction.recommendation }}
                          </small>
                        </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>

              <!-- Model Information -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="card border-0 bg-light">
                    <div class="card-body">
                      <h6 class="card-title text-primary">
                        <i class="fas fa-info-circle me-2"></i>
                        Analysis Information
                      </h6>
                      <ul class="list-unstyled mb-0">
                        <li>
                          <strong>Timestamp:</strong> {{ result.timestamp }}
                        </li>
                        <li>
                          <strong>Image Processed:</strong>
                          {% if result.image_processed %}
                          <span class="text-success">Yes</span>
                          {% else %}
                          <span class="text-danger">No</span>
                          {% endif %}
                        </li>
                        <li>
                          <strong>Model:</strong> {{
                          result.model_info.architecture }}
                        </li>
                        <li>
                          <strong>Accuracy:</strong> {{
                          result.model_info.accuracy }}
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0 bg-warning bg-opacity-10">
                    <div class="card-body">
                      <h6 class="card-title text-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Medical Disclaimer
                      </h6>
                      <p class="mb-0 small">
                        This AI analysis is for educational and research
                        purposes only.
                        <strong
                          >Always consult a qualified dermatologist or
                          healthcare professional</strong
                        >
                        for medical diagnosis, treatment, and advice. This tool
                        should not replace professional medical consultation.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

              <!-- Action Buttons -->
              <div class="text-center mt-4">
                <a href="/" class="btn btn-primary btn-lg me-3">
                  <i class="fas fa-upload me-2"></i>
                  Analyze Another Image
                </a>
                <button
                  class="btn btn-outline-primary btn-lg"
                  onclick="window.print()"
                >
                  <i class="fas fa-print me-2"></i>
                  Print Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light text-center py-4 mt-5">
      <div class="container">
        <p class="mb-0">
          &copy; 2024 Skin Disease AI Classification. Educational purposes only.
        </p>
        <small class="text-muted"
          >Powered by EfficientNet-B3 | 94.04% Accuracy</small
        >
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
